<div class="table-container mat-elevation-z8">
  <table mat-table [dataSource]="dataSource" matSort class="full-width-table">
    <ng-container matColumnDef="pick">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Pick</th>
      <td mat-cell *matCellDef="let card">
        @if (card.mtga_id === bestPickId) {
          <div class="best-pick-badge" matTooltip="Mejor opción estadística">
            <mat-icon>emoji_events</mat-icon>
          </div>
        }
      </td>
    </ng-container>

    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef>Carta</th>
      <td mat-cell *matCellDef="let card">
        <div class="card-thumb">
          <img [src]="card.imageUrl" loading="lazy" />
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
      <td mat-cell *matCellDef="let card">
        <div class="name-col">
          <span class="card-name" [class.highlight-name]="card.mtga_id === bestPickId">
            {{ card.name }}
          </span>
          <span class="card-id">{{ card.mtga_id }}</span>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="color">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Color</th>
      <td mat-cell *matCellDef="let card">
        <div class="mana-container">
          @for (c of card.color.split(''); track c) {
            <span class="mana-symbol" [class]="'mana-' + c.toLowerCase()"></span>
          }
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="tier">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tier</th>
      <td mat-cell *matCellDef="let card">
        <span class="tier-badge" [attr.data-tier]="card.stats?.tier">{{ card.stats?.tier }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="gihWr">
      <th
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        arrowPosition="before"
        matTooltip="Game In Hand Win Rate"
      >
        GIH WR
      </th>
      <td
        mat-cell
        *matCellDef="let card"
        [style.color]="getWrColor(card.stats?.gihWrValue)"
        class="font-bold text-right"
      >
        {{ card.stats?.gihWr }}
      </td>
    </ng-container>

    <ng-container matColumnDef="iwd">
      <th
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        arrowPosition="before"
        matTooltip="Improvement When Drawn"
      >
        IWD
      </th>
      <td mat-cell *matCellDef="let card" class="text-right">
        {{ card.stats?.iwd }}
      </td>
    </ng-container>

    <ng-container matColumnDef="alsa">
      <th
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        arrowPosition="before"
        matTooltip="Average Last Seen At"
      >
        ALSA
      </th>
      <td mat-cell *matCellDef="let card" class="text-muted text-right">
        {{ card.stats?.alsa }}
      </td>
    </ng-container>

    <ng-container matColumnDef="games">
      <th mat-header-cell *matHeaderCellDef mat-sort-header arrowPosition="before"># Games</th>
      <td mat-cell *matCellDef="let card" class="text-muted text-right text-small">
        {{ card.avg_seen | number }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      class="element-row"
      [class.recommended-row]="row.mtga_id === bestPickId"
    ></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons></mat-paginator>
</div>
